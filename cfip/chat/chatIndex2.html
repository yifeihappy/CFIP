<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<meta name="description" content="">
		<meta name="author" content="">

		<title>Off Canvas Template for Bootstrap</title>

		<!-- Bootstrap core CSS -->
		<link href="../../css/bootstrap.min.css" rel="stylesheet">

		<!-- Custom styles for this template -->
		<link href="../../css/dyf/index.css" rel="stylesheet">
		<link rel="stylesheet" href="../../css/dyf/chatIndex.css" />
		<script src="../../jquery/jquery-3.2.1.min.js "></script>
		<script src="../../js/bootstrap.min.js"></script>
		<script type="text/javascript" src="../../js/dyf/user.js"></script>
		<script type="text/javascript" src="../../js/dyf/chatIndex.js" ></script>
	</head>

	<body>

		<nav class="navbar navbar-fixed-top navbar-inverse">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            			<span class="sr-only">Toggle navigation</span>
           				<span class="icon-bar"></span>
            			<span class="icon-bar"></span>
            			<span class="icon-bar"></span>
          			</button>
					<div class="nav navbar-nav navbar-header">
						<li>
							<img src="../../img/logo.png" width="44px" height="44px" />
						</li>
						<li>
							<a href="" id="CFIP" style="text-decoration:none">CFIP</a>
						</li>
					</div>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li>
							<a href="" id="chat">Chat</a>
						</li>
						<!--<li>
							<a href="../act/act.html">活动</a>
						</li>-->
						<li class="dropdown">
							<a href="act.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">活动 <span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#">比赛</a>
								</li>
								<li>
									<a href="#">公益</a>
								</li>
								<li>
									<a href="#">户外</a>
								</li>
								<li>
									<a href="#">讲座</a>
								</li>
								<li>
									<a href="#">艺术</a>
								</li>
								<li>
									<a href="#">游学</a>
								</li>
								<li>
									<a href="#">招聘</a>
								</li>
								<li>
									<a href="#">招新</a>
								</li>
								<li role="separator" class="divider"></li>
								<li>
									<a href="#">其它</a>
								</li>
							</ul>
						</li>
						<li>
							<a href="" id="topic">话题</a>
						</li>
						<li>
							<a href="" id="dengShen">灯神</a>
						</li>
					</ul>

					<form class="navbar-form navbar-left">
						<div class="form-group">
							<input type="text" class="form-control" placeholder="活动/话题">
						</div>
						<button type="submit" class="btn btn-default">搜索</button>
					</form>

					<ul class="nav navbar-nav navbar-right " ng-if="!userService.isLogin">
						<!--<div id="signinDiv" hidden=true>-->
						<li id="signinLI">
							<a href="/CFIP/cfip/user/signin.html">登录</a>
						</li>
						<!--</div>-->
						<!--<div id="signupDiv" hidden=true>-->
						<li id="signupLI" ng-hide="userService.isLogin">
							<a href="/CFIP/cfip/user/signup.html">注册</a>
						</li>
						<!--</div>-->
						<!--<div id="userCenterDiv" hidden=true>-->
						<li id="userCenterLI" class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a href="" id="personalCenter">个人中心</a>
								</li>
								<li>
									<a href="/CFIP/index.html">退出</a>
								</li>
							</ul>
						</li>
						<!--</div>-->
						<!--<div id="publishDiv" hidden=true>-->
						<li id="publishLI" class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>发布<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a herf="" id="addAct">活动</a>
								</li>
								<li>
									<a herf="" id="addTopic">话题</a>
								</li>
								<li role="separator" class="divider"></li>
								<li>
									<a herf="" id="addWall">上墙</a>
								</li>
							</ul>
						</li>
						<!--</div>-->

					</ul>
				</div>
				<!-- /.nav-collapse -->
			</div>
			<!-- /.container -->
		</nav>
		<!-- /.navbar -->

		<div class="container">
			<div class="row">
				<div class="col-md-1 col-md-offset-1 " id="menu">
					<ul class="nav nav-sidebar">
						<li id="contactsMenu" class="active" style="text-align: center;margin: 0px; ">
							<a href=" " style="padding: 0px; "><span class="glyphicon glyphicon-user " aria-hidden="true " style="color:gray;font-size:50px; "></span></a>
							<!--<a href=" " style="margin: 0px; "></span></a>-->
						</li>
						<li id="messageMenu" style="text-align: center;margin: 0px; ">
							<a href=" " style="padding: 0px "><span class="glyphicon glyphicon-envelope " aria-hidden="true " style="color:gray;font-size:50px; "></span></a>
						</li>
					</ul>
				</div>
				<!--"/col-md-1 col-md-offset-1 "-->
				<div class="col-md-2 ">
					<ul id="contactsUl" class="nav nav-sidebar ">
					</ul>
					<ul id="messageUl" class="nav nav-sidebar " hidden="">
						<li>
							<a>消息1</a>
						</li>
					</ul>
				</div>
				<!--</div class="col-md-2 ">-->
				<div class="col-md-7 ">
					<div class="row ">
						<div id="messagePlane" class="col-sm-12 " style="min-height: 200px; border:1px solid #1B6D85; ">
							<div class="row">
								<div class="col-sm-1 you-img">
									<span class="glyphicon glyphicon-user you-glyphicon"></span>
								</div>
								<div class="col-sm-8 you-msg">
									<div class="row ">
										<div class="col-sm-5 ">
											发信息的人：
										</div>
										<div class="col-sm-5 ">
											发送信息的时间：
										</div>
									</div>
									<hr></hr>
									<div class="row">
										<div class="col-sm-10 ">
											信息内容
										</div>
									</div>
								</div>
							</div>

							<div class="row ">
								<div class="col-sm-8 col-sm-offset-3 i-msg">
									<div class="row ">
										<div class="col-sm-5 ">
											发信息的人：
										</div>
										<div class="col-sm-5 ">
											发送信息的时间：
										</div>
									</div>
									<hr></hr>
									<div class="row">
										<div class="col-sm-10 ">
											信息内容
										</div>
									</div>
								</div>
								<div class="col-sm-1 i-img">
									<span class="glyphicon glyphicon-user i-glyphicon"></span>
								</div>
							</div>

						</div>
					</div>

					<div class="row " style=" border:1px solid #1B6D85;margin-top: 10px; ">
						<div class="col-sm-10 form-group " style="margin-top: 10px; ">
							<textarea id="messageTextarea" rows="6 " class="form-control " autofocus style="overflow-x:hidden "></textarea>
						</div>
						<div class="col-sm-2 form-group " style="padding: 0px;margin-top: 10px;padding-right: 10px; ">
							<div style="margin-bottom: 10px; ">
								<button id="sendBtn" class="form-control btn btn-block " style="background-color:#269ABC ">发生信息</button>
							</div>
							<div>
								<button id="sendFileBtn" class="form-control btn btn-block " style="background-color:#269ABC ">发送文件</button>
							</div>
						</div>
					</div>
				</div>
				<!--</div class="col-md-7 ">-->
			</div>
		</div>

		<!-- Bootstrap core JavaScript
    ================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script>
			var userID;
			var userIDMsgTriggerID;
			var curYID; //当前对话窗口的对方用户ID
			var curYIDMsgTriggerID;
			var studentArray;
			var teacherArray;
			$(document).ready(function() {
				userID = isSignIn(); //判断用户有没有登录进行页面变化
				userID = "1513685359511";
				curYID = "1513685380811";
				userIDMsgTriggerID = getMessageTrigger(userID);
				curYIDMsgTriggerID = getMessageTrigger(curYID);
				studentURL = "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Student/";
				teacherURL = "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Teacher/";
				$.ajax({
					type: "get",
					url: studentURL,
					async: false,
					success: function(studentArrayObj, state) {
						console.log("查询Student" + state);
						console.log(studentArrayObj);
						studentArray = studentArrayObj.Student;
					},
					error: function(data, state) {
						console.log("查询Student失败" + state);
					}
				});

				$.ajax({
					type: "get",
					url: teacherURL,
					async: false,
					success: function(teacherArrayObj, state) {
						console.log("查询Teacher" + state);
						console.log(teacherArrayObj);
					},
					error: function(data, state) {
						console.log("查询Student失败" + state);
					}
				});

				for(var i = 0; i < studentArray.length; i++) {
					if(studentArray[i].studentnumber == userID) {
						continue;
					}
					var studentA = $("<a href=''></a>").text(studentArray[i].studentname + "\n" + studentArray[i].studentnumber);
					var studentLi = $("<li></li>").attr("id", studentArray[i].studentnumber);
					studentLi.append(studentA);
					$("#contactsUl").append(studentLi);
					$("#" + studentArray[i].studentnumber).click(function() {
						window.event.returnValue = false;
						console.log(this.id);
					});
				}

				$("#contactsMenu").click(function() {
					$("#contactsUl").show();
					$("#messageUl").hide();
					return false; //==window.event.returnValue = false;
				});

				$("#messageMenu").click(function() {
					$("#contactsUl").hide();
					$("#messageUl").show();
					return false;
				});

				$("#sendBtn").click(function() {
					var msg = $("#messageTextarea").val(); //获取当前textarea文本框里的消息
					console.log(msg);
					if("" == msg) {
						alert("输入信息不能为空！");
					} else {
						$("#messageTextarea").val(""); //清空

						var currentTime = getFormatDate(); //获取当前时间
						/***改变当前的页面，添加自己发送信息的内容******/
						createIMsgItem(userID, currentTime, msg);
						//createYMsgItem(userID, currentTime, msg);



//						/******发送信息******/
//						var msgIObj = {
//							fromuserid: parseInt(userID),
//							touserid: parseInt(curYID),
//							msgcontent: msg,
//							state: "1",
//							msgtime: currentTime,
//							type: "1"
//						};
//						var msgJsonStr = JSON.stringify(msgIObj);
//						console.log(msgJsonStr);
//						$.ajax({
//							type: "POST",
//							url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Message/",
//							contentType: "application/json",
//							data: msgJsonStr,
//							async: true,
//							success: function(data, state) {
//								console.log("发送信息成功");
//								var msgTriggerObj = {
//									userid: curYID,
//									state: "1"
//								};
//								var msgJsonStrTr = JSON.stringify(msgTriggerObj);
//								$.ajax({
//									type: "put",
//									url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Messagetrigger/" + curYIDMsgTriggerID,
//									contentType: "application/json",
//									data: msgJsonStrTr,
//									async: true,
//									success:function(data,state) {
//										console.log("trigger success");
//									},
//									error:function(data, state) {
//										console.log("trigger fialier!");
//									}
//								});
//							},
//							error: function(data, state) {
//								alert("发送信息失败！");
//							}
//						});



					}
					//var divP = $("<div></div>").text("信息发出者");

				});

				$("#sendFileBtn").click(function() {

				});
			})

			function getFormatDate() {
				var nowDate = new Date();
				var year = nowDate.getFullYear();
				var month = nowDate.getMonth() + 1 < 10 ? "0" + (nowDate.getMonth() + 1) : nowDate.getMonth() + 1;
				var date = nowDate.getDate() < 10 ? "0" + nowDate.getDate() : nowDate.getDate();
				var hour = nowDate.getHours() < 10 ? "0" + nowDate.getHours() : nowDate.getHours();
				var minute = nowDate.getMinutes() < 10 ? "0" + nowDate.getMinutes() : nowDate.getMinutes();
				//var second = nowDate.getSeconds() < 10 ? "0" + nowDate.getSeconds() : nowDate.getSeconds();
				return year + "-" + month + "-" + date + "T" + hour + ":" + minute;
			}
		</script>
	</body>

</html>