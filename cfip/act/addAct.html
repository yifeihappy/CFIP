<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<meta name="description" content="">
		<meta name="author" content="">

		<title>Off Canvas Template for Bootstrap</title>

		<!-- Bootstrap core CSS -->
		<link href="../../css/bootstrap.min.css" rel="stylesheet">

		<!-- Custom styles for this template -->
		<link href="../../css/dyf/index.css" rel="stylesheet">
		<script src="../../jquery/jquery-3.2.1.min.js " type="text/javascript"></script>
		<script src="../../js/bootstrap.min.js" type="text/javascript"></script>
		<script src="../../js/dyf/user.js"></script>
	</head>

	<body>
		<nav class="navbar navbar-fixed-top navbar-inverse">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
					<div class="nav navbar-nav navbar-header">
						<li>
							<img src="../../img/logo.png" width="44px" height="44px" />
						</li>
						<li>
							<a href="" id="CFIP" style="text-decoration:none">CFIP</a>
						</li>
					</div>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li>
							<a href="" id="chat">Chat</a>
						</li>
						<li>
							<a href="" id="act">活动</a>
						</li>
						<li>
							<a href="" id="topic">话题</a>
						</li>
						<li>
							<a href="" id="dengShen">灯神</a>
						</li>
					</ul>

					<form class="navbar-form navbar-left">
						<div class="form-group">
							<input type="text" class="form-control" placeholder="活动/话题">
						</div>
						<button type="submit" class="btn btn-default" disabled="true">搜索</button>
					</form>

					<ul class="nav navbar-nav navbar-right " ng-if="!userService.isLogin">
						<!--<div id="signinDiv" hidden=true>-->
						<li id="signinLI">
							<a href="/CFIP/cfip/user/signin.html">登录</a>
						</li>
						<!--</div>-->
						<!--<div id="signupDiv" hidden=true>-->
						<li id="signupLI" ng-hide="userService.isLogin">
							<a href="/CFIP/cfip/user/signup.html">注册</a>
						</li>
						<!--</div>-->
						<!--<div id="userCenterDiv" hidden=true>-->
						<li id="userCenterLI" class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a href="" id="personalCenter">个人中心</a>
								</li>
								<li>
									<a href="/CFIP/index.html">退出</a>
								</li>
							</ul>
						</li>
						<!--</div>-->
						<!--<div id="publishDiv" hidden=true>-->
						<li id="publishLI" class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>发布<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a herf="" id="addAct">活动</a>
								</li>
								<li>
									<a herf="" id="addTopic">话题</a>
								</li>
								<li role="separator" class="divider"></li>
								<li>
									<a herf="" id="addWall">上墙</a>
								</li>
							</ul>
						</li>
						<!--</div>-->

					</ul>
				</div>
				<!-- /.nav-collapse -->
			</div>
			<!-- /.container -->
		</nav>
		<!-- /.navbar -->

		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2">
					<form>
						<div class="form-group">
							<input type="text" class="form-control" id="actName" placeholder="活动名称">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" id="actAddress" placeholder="活动地址">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" id="actSponser" placeholder="主办方">
						</div>
						<div class="form-group">
							<select id="actType" class="form-control" required>
								<!-- ngRepeat: t in actTypeLists -->
								<option value="1">
									招新
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="2">
									讲座
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="3">
									艺术
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="4">
									户外
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="5">
									招聘
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="6">
									游学
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="7">
									比赛
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="8">
									公益
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
								<option value="9">
									其他
								</option>
								<!-- end ngRepeat: t in actTypeLists -->
							</select>
						</div>
						<div class="form-group">
							<label>活动开始时间</label>
							<input type="datetime-local" class="form-control" id="actStart" />
						</div>
						<div class="form-group">
							<label>活动结束时间</label>
							<input type="datetime-local" class="form-control" id="actEnd" />
						</div>
						<div class="form-group">
							<label>报名开始时间</label>
							<input type="datetime-local" class="form-control" id="applystart" />
						</div>
						<div class="form-group">
							<label>报名结束时间</label>
							<input type="datetime-local" class="form-control" id="applyEnd" />
						</div>
						<div class="form-group">
							<label>活动海报</label>
							<input type="file" class="form-control" id="actImg" placeholder="主办方">
						</div>
						<div class="form-group">
							<label>活动简介</label>
							<textarea class="form-control" rows="6" id="actBrief"></textarea>
						</div>
						<div class="form-group">
							<input type="number" class="form-control" id="totalNumber" min="0" max="10000" placeholder="活动总人数" />
						</div>
						<div id="addActSubmit" class="btn btn-lg btn-primary btn-block">Submit</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Bootstrap core JavaScript
    ================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->

		<script>
			$(document).ready(function() {
				/**********判断用户有无登录 start*********/
				var userID = isSignIn(); //判断用户有没有登录进行页面变化
				/**********判断用户有无登录 end*********/
				if("" == userID){
					alert("请先登录");
				}
				$("#addActSubmit").click(function() {
//					var actObject = {
//						actname: "狂欢夜",
//						actaddress: "JingJingTang",
//						userid: 1513502243526,
//						actsponser: "KangKang",
//						acttype: "1",
//						actstart: "2017-12-30T12:00",
//						actend: "2017-12-31T17:00",
//						applystart: "2017-12-22T12:00",
//						applyend: "2017-12-30T12:00",
//						//actbrief: "关于AI，他们要说——\n霍金： 全面人工智能化会导致人类灭亡。\n马斯克： 人工智能是人类生存最大威胁。\n比尔 ? 盖茨： 人类需要敬畏AI的崛起。\n关于AI， 我们想问——\nAlpha Go是如何打败柯杰的？\nsiri是如何一步步“ 沦落” 至任人调戏？\nI程序员们内心究竟寄居着怎样的小怪兽？\n这一次\n我们聚集了行业大神， 学术大牛\n试图为你提供最全面的答案 ",
//						actbrief: "新年好呀 新年好呀 祝福大家新年好我们唱歌 我们跳舞 祝福大家新年好另类歌词：小小姑娘 清早起床 提着花蓝上市场 穿过大街 走过小巷 卖花卖花声声唱 花儿虽美 花儿虽香 没人来卖怎么样 满满花蓝 空空小囊 如何回去见爹娘 ",
//						totalnumber: 100,
//						participantnumber: 0,
//						viewernumber: 0
//					}
					var actObject = {
						actname: $("#actName").val(),
						actaddress: $("#actAddress").val(),
						userid: 1513417478927,
						actsponser: $("#actSponser").val(),
						acttype: $("#actType").val(),
						actstart: $("#actStart").val(),
						actend: $("#actEnd").val(),
						applystart: $("#applystart").val(),
						applyend: $("#applyEnd").val(),
						actbrief: $("#actBrief").val(),
						totalnumber: parseInt($("#totalNumber").val()),
						participantnumber: 0,
						viewernumber: 0
					};
					var dataJsonStr = JSON.stringify(actObject);
					//console.log(dataJsonStr);
					$.ajax({
						type: "post",
						url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Activity/",
						async: false,
						data: dataJsonStr,
						contentType: "application/json",
						success: function(data, state) {
							console.log("上传活动基本信息成功！");
							console.log(state);
							console.log(data);
							console.log(data.id);

							var files = $(":file")[0].files;
							var formData = new FormData();
							formData.append("file", files[0]);
							$.ajax({
								//http://112.74.35.75:8080/file/U3d616b41047817/CFIP/Activity/1513472664404
								url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Activity/" + data.id,
								type: "POST",
								data: formData,
								async: false,
								contentType: false,
								processData: false,
								error: function(dataImg, stateImg) {
									console.log(stateImg);
									console.log(dataImg);
									//return false;
								},
								success: function(dataImg, stateImg) {
									console.log("上传文件成功！");
									console.log(stateImg);
									console.log(dataImg);
									
									window.location.href = "/CFIP/cfip/act/act.html?userID=" + userID;
								}
							});
						},
						error: function(data, state) {
							console.log(data);
							console.log(state);
						}
					});
				});
			});
		</script>
	</body>

</html>