<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../../css/jh/template2.css" />
		<link rel="stylesheet" href="../../css/bootstrap.min.css" />
		<link href="../../css/dyf/signup.css" rel="stylesheet" />

		<script src="../../jquery/jquery-3.2.1.min.js "></script>
		<script src="../../js/bootstrap.min.js"></script>
		<script src="../../js/dyf/user.js"></script>
		<script src="/CFIP/js/qpj/userIDtianjia.js"></script>
	</head>

	<body>

		<div class="row" id="top-nav">
			<div class="col-md-12">
				<nav class="navbar navbar-fixed-top navbar-inverse">
					<div class="container">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
							<div class="nav navbar-nav navbar-header">
								<li>
									<img src="../../img/logo.png" width="44px" height="44px" />
								</li>
								<li>
									<a href="" id="CFIP" style="text-decoration:none">CFIP</a>
								</li>
							</div>
						</div>
						<div id="navbar" class="collapse navbar-collapse">
							<ul class="nav navbar-nav">
								<li>
									<a href="#">Chat</a>
								</li>
								<li>
									<a href="cfip/act/act.html">活动</a>
								</li>
								<!--<li class="dropdown">
										<a href="act.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">活动 <span class="caret"></span></a>
										<ul class="dropdown-menu">
											<li>
												<a href="#">比赛</a>
											</li>
											<li>
												<a href="#">公益</a>
											</li>
											<li>
												<a href="#">户外</a>
											</li>
											<li>
												<a href="#">讲座</a>
											</li>
											<li>
												<a href="#">艺术</a>
											</li>
											<li>
												<a href="#">游学</a>
											</li>
											<li>
												<a href="#">招聘</a>
											</li>
											<li>
												<a href="#">招新</a>
											</li>
											<li role="separator" class="divider"></li>
											<li>
												<a href="#">其它</a>
											</li>
										</ul>
									</li>-->
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">话题<span class="caret"></span></a>
									<ul class="dropdown-menu">
										<li>
											<a href="#">明星</a>
										</li>
										<li>
											<a href="#">搞笑</a>
										</li>
										<li>
											<a href="#">情感</a>
										</li>
										<li>
											<a href="#">时尚</a>
										</li>
										<li>
											<a href="#">军事</a>
										</li>
										<li>
											<a href="#">美女</a>
										</li>
										<li>
											<a href="#">体育</a>
										</li>
										<li>
											<a href="#">动漫</a>
										</li>
										<li role="separator" class="divider"></li>
										<li>
											<a href="#">其它</a>
										</li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">灯神<span class="caret"></span></a>
									<ul class="dropdown-menu">
										<li>
											<a href="#">表白墙</a>
										</li>
										<li>
											<a href="#">心愿墙</a>
										</li>
										<li>
											<a href="#">闲物店</a>
										</li>
									</ul>
								</li>
							</ul>

							<form class="navbar-form navbar-left">
								<div class="form-group">
									<input type="text" class="form-control" placeholder="活动/话题">
								</div>
								<button type="submit" class="btn btn-default">搜索</button>
							</form>

							<ul class="nav navbar-nav navbar-right " ng-if="!userService.isLogin">
								<li>
									<a href="/CFIP/cfip/user/signin.html">登录</a>
								</li>
								<li ng-hide="userService.isLogin">
									<a href="/CFIP/cfip/user/signup.html">注册</a>
								</li>
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
										<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>发布<span class="caret"></span></a>
									<ul class="dropdown-menu">
										<li>
											<a href="#">活动</a>
										</li>
										<li>
											<a href="#">话题</a>
										</li>
										<li role="separator" class="divider"></li>
										<li>
											<a href="#">心愿</a>
										</li>
										<li>
											<a href="#">表白</a>
										</li>
										<li>
											<a href="#">闲物</a>
										</li>
									</ul>
								</li>
							</ul>
						</div>
						<!-- /.nav-collapse -->
					</div>
					<!-- /.container -->
				</nav>

			</div>
		</div>

		<div class="container">
			<div class="row" id="sidebar">
				<div class="col-md-2 sidebar">
					<ul class="nav nav-pills nav-stacked">
						<li>
							<a href="basic information.html">基本信息</a>
						</li>
						<li>
							<a href="#">我的消息</a>
						</li>
						<li class="active">
							<a href="application.html">申请审批</a>
						</li>
						<li>
							<a href="settings.html" target="_self">个人设置</a>
						</li>
					</ul>
				</div>
				<div class="col-md-7 sidebar">
					<ul class="nav nav-tabs">
						<li role="presentation" class="active">
							<a href="" id="T_zhuxuejin">助学金申请</a>
						</li>
						<li role="presentation">
							<a href="" id="T_jiangxuejin">奖学金申请</a>
						</li>
					</ul>
					<div id="applyzhanshi" class="container">

					</div>

				</div>
				<div class="col-md-3 sidebar-offcanvas">
					<div class="row">
						<div class="col-md-6">
							<img src="../../img/logo.png" width="44px" height="44px" />
							<span>猜你喜欢</span>
						</div>
					</div>
					<div class="row list-group">
						<a href="#" class="list-group-item active"></a>
						<a href="#" class="list-group-item">吃鲸电子科技招募实习生</a>
						<a href="#" class="list-group-item">吃鲸电子科技招募实习生</a>
						<a href="#" class="list-group-item">吃鲸电子科技招募实习生</a>
						<a href="#" class="list-group-item">吃鲸电子科技招募实习生</a>
						<a href="#" class="list-group-item">吃鲸电子科技招募实习生</a>
					</div>
					<!--<div class="list-group">
						<a href="#" class="list-group-item active">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
						<a href="#" class="list-group-item">Link</a>
					</div>-->
				</div>
			</div>
			<div>
				<!--/row-->
				offcanvas
				<hr>

				<footer>
					<p>&copy; 2017 Company, Inc.</p>
				</footer>

			</div>
		</div>

		<script>
			$(document).ready(function() {
				/**********判断用户有无登录 start*********/
				var userID = isSignIn(); //判断用户有没有登录进行页面变化
				/**********判断用户有无登录 end*********/
				userIDtianjia();

				$.ajax({
					type: "get",
					url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Apply/",
					async: false,
					success: function(data, state) {
						console.log("adf");
						console.log(state);
						console.log(data);
						for(var i = data.Apply.length - 1; i >= 0; i--) {

							var dType = data.Apply[i].type;
							var dState = data.Apply[i].state;
							if(dType == "1" && dState == "0") {
								var PublisherName = $("<font size='3'></font>").text(data.Apply[i].userid);
								var PersonalHomepageURL = "#"; //连接到“他的主页”
								var PublisherHomepage = $("<a></a>").attr("href", PersonalHomepageURL);
								PublisherHomepage.append(PublisherName);
								var divPublisherName = $("<div class='col-md-1'></div>");
								divPublisherName.append(PublisherHomepage);

								var hTitle = $("<h3></h3>").text(data.Apply[i].title);
								var pContent = $("<p></p>").text(data.Apply[i].content);
								var divNeiRong = $("<div class='col-md-11'></div>");
								divNeiRong.append(hTitle, pContent);

								var divROW1 = $("<div class='row'></div>");
								divROW1.append(divPublisherName, divNeiRong);

								var yesBtn = $("<button  type='button' class='btn btn-info'></button>").text("通过");
								yesBtn.attr("id", "yesbtn" + data.Apply[i].id);
								yesBtn.click(function() {
									var applyID = this.id.substr(6);
									console.log(applyID);
									$.ajax({
										type: "get",
										url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Apply/" + applyID,
										async: true,
										success: function(data, state) {
											console.log(data);
											console.log(state);
											var ApplyInfo = {
												userid: data.userid,
												type: data.type,
												title: data.title,
												content: data.content,
												publishtime: data.publishtime,
												state: "1"
											};
											var dataJsonStr = JSON.stringify(ApplyInfo);
											console.log(dataJsonStr);
											$.ajax({
												url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Apply/" + applyID,
												contentType: "application/json",
												type: "PUT",
												data: dataJsonStr,
												async: true,
												error: function(data, state) {
													console.log(data);
													console.log(state);
												},
												success: function(data, state) {
													console.log(state);
													console.log(data);

													var indexUrl = encodeURI("application_zhuxuejin.html?userID=" + userID);
													console.log(indexUrl);
													window.location.href = indexUrl;
												}
											});
										},
										error: function(data, state) {
											console.log(data);
											console.log(state);
										}
									});

								})
								var noBtn = $("<button type='button' class='btn btn-info'></button>").text("不通过");
								noBtn.attr("id", "nobtn" + data.Apply[i].id);
								noBtn.click(function() {
									var applyID = this.id.substr(5);
									console.log(applyID);
									$.ajax({
										type: "get",
										url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Apply/" + applyID,
										async: true,
										success: function(data, state) {
											console.log(data);
											console.log(state);
											var ApplyInfo = {
												userid: data.userid,
												type: data.type,
												title: data.title,
												content: data.content,
												publishtime: data.publishtime,
												state: "2"
											};
											var dataJsonStr = JSON.stringify(ApplyInfo);
											console.log(dataJsonStr);
											$.ajax({
												url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Apply/" + applyID,
												contentType: "application/json",
												type: "PUT",
												data: dataJsonStr,
												async: true,
												error: function(data, state) {
													console.log(data);
													console.log(state);
												},
												success: function(data, state) {
													console.log(state);
													console.log(data);

													var indexUrl = encodeURI("application_zhuxuejin.html?userID=" + userID);
													console.log(indexUrl);
													window.location.href = indexUrl;
												}
											});
										},
										error: function(data, state) {
											console.log(data);
											console.log(state);
										}
									});

								})

								var divBtn = $("<div class='col-md-3 col-md-offset-5'></div>");
								divBtn.append(yesBtn, noBtn);

								var divROW2 = $("<div class='row'></div>");
								divROW2.append(divBtn);

								var divHr = $("<div class='col-md-12'></div>");
								divHr.append($("<hr>"));

								$("#applyzhanshi").append($("<br>"), divROW1, divROW2, divHr);
							}

						}
					},
					error: function(data, state) {
						console.log(state);
						console.log(data);
					}
				});

			});
		</script>

	</body>

</html>