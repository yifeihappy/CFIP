<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<meta name="description" content="">
		<meta name="author" content="">
		<title>Off Canvas Template for Bootstrap</title>

		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">

		<!-- Custom styles for this template -->
		<link href="css/dyf/index.css" rel="stylesheet">
		<script src="jquery/jquery-3.2.1.min.js "></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/dyf/user.js"></script>

	</head>

	<body>

		<nav class="navbar navbar-fixed-top navbar-inverse">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
					<div class="nav navbar-nav navbar-header">
						<li>
							<img src="img/logo.png" width="44px" height="44px" />
						</li>
						<li>
							<a href="" id="CPFI" style="text-decoration:none">CPFI</a>
						</li>
					</div>
				</div>
				<div id="navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li>
							<a href="" id="chat">Chat</a>
						</li>
						<li>
							<a href="" id="act">活动</a>
						</li>
						<li>
							<a href="" id="topic">话题</a>
						</li>
						<li>
							<a href="" id="dengShen">灯神</a>
						</li>
						<!--<li class="dropdown">
										<a href="act.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">活动 <span class="caret"></span></a>
										<ul class="dropdown-menu">
											<li>
												<a href="#">比赛</a>
											</li>
											<li>
												<a href="#">公益</a>
											</li>
											<li>
												<a href="#">户外</a>
											</li>
											<li>
												<a href="#">讲座</a>
											</li>
											<li>
												<a href="#">艺术</a>
											</li>
											<li>
												<a href="#">游学</a>
											</li>
											<li>
												<a href="#">招聘</a>
											</li>
											<li>
												<a href="#">招新</a>
											</li>
											<li role="separator" class="divider"></li>
											<li>
												<a href="#">其它</a>
											</li>
										</ul>
									</li>-->
						<!--<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">话题<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#">明星</a>
								</li>
								<li>
									<a href="#">搞笑</a>
								</li>
								<li>
									<a href="#">情感</a>
								</li>
								<li>
									<a href="#">时尚</a>
								</li>
								<li>
									<a href="#">军事</a>
								</li>
								<li>
									<a href="#">美女</a>
								</li>
								<li>
									<a href="#">体育</a>
								</li>
								<li>
									<a href="#">动漫</a>
								</li>
								<li role="separator" class="divider"></li>
								<li>
									<a href="#">其它</a>
								</li>
							</ul>
						</li>-->
						<!--<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">灯神<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#">表白墙</a>
								</li>
								<li>
									<a href="#">心愿墙</a>
								</li>
								<li>
									<a href="#">闲物店</a>
								</li>
							</ul>
						</li>-->
					</ul>

					<form class="navbar-form navbar-left">
						<div class="form-group">
							<input type="text" id="searchInput" class="form-control" placeholder="活动/话题">
						</div>
						<button type="submit" id="searchBtn" class="btn btn-default">搜索</button>
					</form>

					<ul class="nav navbar-nav navbar-right " ng-if="!userService.isLogin">
						<!--<div id="signinDiv" hidden=true>-->
						<li id="signinLI">
							<a href="/CFIP/cfip/user/signin.html">登录</a>
						</li>
						<!--</div>-->
						<!--<div id="signupDiv" hidden=true>-->
						<li id="signupLI" ng-hide="userService.isLogin">
							<a href="/CFIP/cfip/user/signup.html">注册</a>
						</li>
						<!--</div>-->
						<!--<div id="userCenterDiv" hidden=true>-->
						<li id="userCenterLI" class="dropdown">
							<a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a herf="" style="cursor:pointer" id="userCenterID">个人中心</a>
								</li>
								<li>
									<a href="/CFIP/index.html">退出</a>
								</li>
							</ul>
						</li>
						<!--</div>-->
						<!--<div id="publishDiv" hidden=true>-->
						<li id="publishLI" class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>发布<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li>
									<a herf="" style="cursor:pointer" id="addAct">活动</a>
								</li>
								<li>
									<a herf="" style="cursor:pointer" id="addTopic">话题</a>
								</li>
								<li role="separator" class="divider"></li>
								<li>
									<a herf="" style="cursor:pointer" id="addWall">上墙</a>
								</li>
							</ul>
						</li>
						<!--</div>-->

					</ul>
				</div>
				<!-- /.nav-collapse -->
			</div>
			<!-- /.container -->
		</nav>
		<!-- /.navbar -->
		<div class="container">
			<div class="row row-offcanvas row-offcanvas-right">
				<div class="col-md-9">
					<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
						<!-- Indicators -->
						<ol class="carousel-indicators">
							<li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
							<li data-target="#carousel-example-generic" data-slide-to="1"></li>
							<li data-target="#carousel-example-generic" data-slide-to="2"></li>
						</ol>
						<!-- Wrapper for slides -->
						<div class="carousel-inner" role="listbox">
							<div class="item active">
								<img src="img/Desert.jpg" alt="...">
								<div class="carousel-caption">
									...
								</div>
							</div>
							<div class="item">
								<img src="img/Jellyfish.jpg" alt="...">
								<div class="carousel-caption">
									...
								</div>
							</div>
							<div class="item">
								<img src="img/Koala.jpg" alt="...">
								<div class="carousel-caption">
									...
								</div>
							</div>
						</div>

						<!-- Controls -->
						<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
							<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
							<span class="sr-only">Previous</span>
						</a>
						<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
							<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
							<span class="sr-only">Next</span>
						</a>
					</div>
					<!--/.container-->

				</div>
				<div class="col-md-3">
					<div class="row">
						<div class="col-md-12">
							<img src="img/logo.png" width="44px" height="44px" />
							<span>猜你喜欢</span>
						</div>
					</div>
					<div class="row list-group" id="guessList">
					</div>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div class="col-md-6">
					<img src="img/logo.png" width="44px" height="44px" />
					<span>热门活动</span>
				</div>
				<div class="col-md-2 col-md-offset-2">
					<a href="" id="actMore">更多</a>
				</div>
			</div>
			<div class="container">
				<div id="actthumbnails" class="row">
				</div>
			</div>
			<!--/row-->

			<div class="row">
				<div class="col-md-6">
					<img src="img/logo.png" width="44px" height="44px" />
					<span>热门话题</span>
				</div>
				<div class="col-md-2 col-md-offset-2">
					<a href="" id="topicMore">更多</a>
				</div>
			</div>

			<div class="container" id="contanier-topicThumbnails">
				<div id="topicthumbnails" class="row">

				</div>
			</div>

		</div>

		<script>
			$(document).ready(function() {
				/**********判断用户有无登录 start*********/
				userID = isSignIn();
				console.log(userID);
				//判断用户有没有登录进行页面变化
				/**********判断用户有无登录 end*********/

				$.ajax({
					type: "get",
					url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Activity/",
					//url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Student/?Student.",
					async: false,
					success: function(data, state) {
						console.log(state);
						console.log(data);

						var hotActivityArry = data.Activity;

						function compare(property) {
							return function(a, b) {
								var value1 = a[property];
								var value2 = b[property];
								return value2 - value1;
							}
						}

						hotActivityArry = hotActivityArry.sort(compare("viewernumber"));
						console.log(hotActivityArry);

						for(var i = 0; i < 3; i++) {
							var hTitle = $("<h3></h3>").text(data.Activity[i].actname);
							var pAddr = $("<p></p>").text("活动地点：" + data.Activity[i].actaddress);
							var pActTime = $("<p></p>").text("活动时间：" + data.Activity[i].actstart + "至" + data.Activity[i].actend);
							var pSponser = $("<p></p>").text("主办单位：" + data.Activity[i].actsponser);
							var pNumber = $("<p></p>").text("报名人数：" + data.Activity[i].participantnumber + "|" + data.Activity[i].totalnumber);
							var pApplyEnd = $("<p></p>").text("报名截止：" + data.Activity[i].applyend);
							var divCaption = $("<div class='caption'></div>");
							divCaption.append(hTitle, pAddr, pActTime, pSponser, pNumber, pApplyEnd);

							var imgAct = $("<img></img>").attr({
								"src": "http://112.74.35.75:8080/file/U3d616b41047817/CFIP/Activity/" + data.Activity[i].id,
								"alt": "...."
							});
							var divThumbnail = $("<div class='thumbnail'></div>");
							divThumbnail.append(imgAct);

							//							var div1 = $("<div class='col-md-8 col-md-offset-2'></div>");
							//							div1.append(divRow1, $("<hr>"));

							var actDetailUrl;
							if("" == userID) {
								actDetailUrl = "/CFIP/cfip/act/actDetail.html?actID=" + data.Activity[i].id;
							} else {
								actDetailUrl = encodeURI("/CFIP/cfip/act/actDetail.html?actID=" + data.Activity[i].id + "userID=" + userID);
							}

							var actDetailA = $("<a></a>").attr("href", actDetailUrl);
							actDetailA.append(divThumbnail, divCaption);

							var divRow1 = $("<div class='col-md-3'></div>");
							divRow1.append(actDetailA);

							$("#actthumbnails").append(divRow1);
							//							var divRow2 = $("<div class='row'></div>");
							//							divRow2.append(actDetailA);

							//							$("#actthumbnails").append(divRow2);

						}
					},
					error: function(data, state) {
						console.log(state);
						console.log(data);
					}
				});
				$.ajax({
					type: "get",
					url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Topic/",
					//url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Student/?Student.",
					async: false,
					success: function(data, state) {
						console.log(state);
						console.log(data);

						var hotTopicArry = data.Topic;

						function compare(property) {
							return function(a, b) {
								var value1 = a[property];
								var value2 = b[property];
								return value2 - value1;
							}
						}

						hotTopicArry = hotTopicArry.sort(compare("viewernumber"));
						console.log(hotTopicArry);

						for(var i = 0; i < 3; i++) {
							var hTitle = $("<h3></h3>").text(data.Topic[i].title);
							var topicBrief = $("<p></p>").text("内容：" + data.Topic[i].brief);
							var ppers = $("<p></p>").text("发布人：" + data.Topic[i].authorname);
							var pTopTime = $("<p></p>").text("发布时间：" + data.Topic[i].publishtime);
							var divCaption = $("<div class='caption'></div>");
							divCaption.append(hTitle, topicBrief, ppers, pTopTime);

							var imgTopic = $("<img></img>").attr({
								"src": "http://112.74.35.75:8080/file/U3d616b41047817/CFIP/Topic/" + data.Topic[i].id,
								"alt": "...."
							});
							var divThumbnail = $("<div class='thumbnail'></div>");
							divThumbnail.append(imgTopic);

							//							var divRow1 = $("<div class='row'></div>");
							//							divRow1.append(divThumbnail, divCaption);
							//							var div1 = $("<div class='col-md-8 col-md-offset-2'></div>");
							//							div1.append(divRow1, $("<hr>"));

							var topicDetailUrl;
							if("" == userID) {
								topicDetailUrl = "/CFIP/cfip/topic/topicDetail.html?topicID=" + data.Topic[i].id;
							} else {
								topicDetailUrl = encodeURI("/CFIP/cfip/topic/topicDetail.html?topicID=" + data.Topic[i].id + "userID=" + userID);
							}

							var topicDetailA = $("<a></a>").attr("href", topicDetailUrl);
							topicDetailA.append(divThumbnail, divCaption);

							var divRow2 = $("<div class='col-md-3'></div>");
							divRow2.append(topicDetailA);

							//							var divRow2 = $("<div class='col-xs-6 col-lg-4'></div>");
							//							divRow2.append(actDetailA);

							$("#topicthumbnails").append(divRow2);

						}

					},
					error: function(data, state) {
						console.log(state);
						console.log(data);
					}
				});

				if("" != userID) {
					$.ajax({
						type: "get",
						url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Userprofile/?Userprofile.userid=" + userID,
						async: true,
						success: function(data, state) {
							if("{}" != JSON.stringify(data)) {
								console.log("查询Userprofile成功");
								//根据历史推荐活动
								actUserArr = new Array();
								for(var i = 0; i < 9; i++) {
									var actObj = {
										type: i + 1,
										num: data.Userprofile[0]["act" + (i + 1)]
									}
									actUserArr[i] = actObj;

								}
								actUserArr.sort(sortUserAct);
								console.log(actUserArr);

								$.ajax({
									type: "get",
									url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Activity/?Activity.acttype=" + actUserArr[0].type,
									//url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Student/?Student.",
									async: false,
									success: function(data, state) {
										console.log("搜索特定类型的对象成功！");
										console.log(data);
										if("{}" != JSON.stringify(data)) {
											console.log("搜索特定类型的对象成功！")
											var actArr = data.Activity;
											actArr.sort(sortAct);
											console.log("通过viewNumber排序后");
											console.log(actArr);
											console.log(actArr[0].actname);
											var actGuessA = $('<a class="list-group-item"></a>').text(actArr[0].actname);
											actGuessA.attr("href", encodeURI("/CFIP/cfip/act/actDetail.html?actID=" + actArr[0].id + "userID=" + userID));
											$("#guessList").append(actGuessA);
										}
									},
									error: function(data, state) {

									}
								});
								//根据历史推荐话题
								topicUserArr = new Array();
								for(var i = 0; i < 9; i++) {
									var topicObj = {
										type: i + 1,
										num: data.Userprofile[0]["topic" + (i + 1)]
									}
									topicUserArr[i] = topicObj;

								}
								topicUserArr.sort(sortUserTopic);
								console.log(topicUserArr);

								$.ajax({
									type: "get",
									url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Topic/?Topic.topictype=" + topicUserArr[0].type,
									//url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Student/?Student.",
									async: false,
									success: function(data, state) {
										console.log("搜索特定类型的对象成功！");
										console.log(data);
										if("{}" != JSON.stringify(data)) {
											console.log("搜索特定类型的对象成功！")
											var topicArr = data.Topic;
											topicArr.sort(sortTopic);
											console.log("通过viewNumber排序后");
											console.log(topicArr);
											console.log(topicArr[0].title);
											var actGuessA = $('<a class="list-group-item"></a>').text(topicArr[0].title);
											actGuessA.attr("href", encodeURI("/CFIP/cfip/topic/topicDetail.html?topicID=" + topicArr[0].id + "userID=" + userID));
											$("#guessList").append(actGuessA);
										} else {
											console.log("没找到对应的话题内容");
										}
									},
									error: function(data, state) {

									}
								});

							} else {
								console.log("userProfile == {}");
							}
						},
						error: function(data, state) {

						}
					});
				}

				$("#searchBtn").click(function() {
					window.event.returnValue = false;
					if("" != $("#searchInput").val()) {
						//查询话题
						var searchName = $("#searchInput").val();
						console.log("search");
						$("#topicthumbnails").empty();
						$.ajax({
							type: "get",
							url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Topic/?Topic.title=(like)" + searchName,
							async: true,
							success: function(data, state) {
								console.log(state);
								console.log(data);
								if("{}" != JSON.stringify(data)) {
									for(var i = 0; i < data.Topic.length; i++) {
										var hTitle = $("<h3></h3>").text(data.Topic[i].title);
										var topicBrief = $("<p></p>").text("内容：" + data.Topic[i].brief);
										var ppers = $("<p></p>").text("发布人：" + data.Topic[i].authorname);
										var pTopTime = $("<p></p>").text("发布时间：" + data.Topic[i].publishtime);
										var divCaption = $("<div class='col-md-8 col-sm-8 col-xs-8  caption'></div>");
										divCaption.append(hTitle, topicBrief, ppers, pTopTime);

										var imgTopic = $("<img></img>").attr({
											"src": "http://112.74.35.75:8080/file/U3d616b41047817/CFIP/Topic/" + data.Topic[i].id,
											"alt": "...."
										});
										var divThumbnail = $("<div class='col-md-4 col-sm-4 col-xs-4 thumbnail'></div>");
										divThumbnail.append(imgTopic);

										var divRow1 = $("<div class='row'></div>");
										divRow1.append(divThumbnail, divCaption);

										var div1 = $("<div class='col-md-8 col-md-offset-2'></div>");
										div1.append(divRow1, $("<hr>"));

										var topicDetailUrl;
										if("" == userID) {
											topicDetailUrl = "/CFIP/cfip/topic/topicDetail.html?topicID=" + data.Topic[i].id;
										} else {
											topicDetailUrl = encodeURI("/CFIP/cfip/topic/topicDetail.html?topicID=" + data.Topic[i].id + "userID=" + userID);
										}

										var topicDetailA = $("<a></a>").attr("href", topicDetailUrl);
										topicDetailA.append(div1);

										var divRow2 = $("<div class='row'></div>");
										divRow2.append(topicDetailA);

										$("#topicthumbnails").append(divRow2);
									}
								}
							},
							error: function(data, state) {
								console.log(state);
								console.log(data);
							}
						});
						//查询活动
						var searchName = $("#searchInput").val();
						console.log("search");
						$.ajax({
							type: "get",
							url: "http://112.74.35.75:8080/Entity/U3d616b41047817/CFIP/Activity/?Activity.actname=(like)" + searchName,
							async: true,
							success: function(data, state) {
								console.log(state);
								console.log(data);
								$("#actthumbnails").empty();
								if("{}" != JSON.stringify(data)) {

									for(var i = 0; i < data.Activity.length; i++) {
										var hTitle = $("<h3></h3>").text(data.Activity[i].actname);
										var pAddr = $("<p></p>").text("活动地点：" + data.Activity[i].actaddress);
										var pActTime = $("<p></p>").text("活动时间：" + data.Activity[i].actstart + "至" + data.Activity[i].actend);
										var pSponser = $("<p></p>").text("主办单位：" + data.Activity[i].actsponser);
										var pNumber = $("<p></p>").text("报名人数：" + data.Activity[i].participantnumber + "|" + data.Activity[i].totalnumber);
										var pApplyEnd = $("<p></p>").text("报名截止：" + data.Activity[i].applyend);
										var divCaption = $("<div class='col-md-8 col-sm-8 col-xs-8  caption'></div>");
										divCaption.append(hTitle, pAddr, pActTime, pSponser, pNumber, pApplyEnd);

										var imgAct = $("<img></img>").attr({
											"src": "http://112.74.35.75:8080/file/U3d616b41047817/CFIP/Activity/" + data.Activity[i].id,
											"alt": "...."
										});
										var divThumbnail = $("<div class='col-md-4 col-sm-4 col-xs-4 thumbnail'></div>");
										divThumbnail.append(imgAct);

										var divRow1 = $("<div class='row'></div>");
										divRow1.append(divThumbnail, divCaption);

										var div1 = $("<div class='col-md-8 col-md-offset-2'></div>");
										div1.append(divRow1, $("<hr>"));

										var actDetailUrl;
										if("" == userID) {
											actDetailUrl = "/CFIP/cfip/act/actDetail.html?actID=" + data.Activity[i].id;
										} else {
											actDetailUrl = encodeURI("/CFIP/cfip/act/actDetail.html?actID=" + data.Activity[i].id + "userID=" + userID);
										}

										var actDetailA = $("<a></a>").attr("href", actDetailUrl);
										actDetailA.append(div1);

										var divRow2 = $("<div class='row'></div>");
										divRow2.append(actDetailA);

										$("#actthumbnails").append(divRow2);
									}

								}

							},
							error: function(data, state) {
								console.log(state);
								console.log(data);
							}
						});
					}

				});

			});

			function sortUserAct(a, b) {
				return b.num - a.num;
			}

			function sortUserTopic(a, b) {
				return b.num - a.num;
			}

			function sortAct(a, b) {
				return b.viewernumber - a.viewernumber;
			}

			function sortTopic(a, b) {
				return b.viewernumber - a.viewernumber;
			}
			//			userID = isSignIn();
		</script>
	</body>

</html>